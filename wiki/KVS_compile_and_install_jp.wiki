#sidebar table_of_contents_jp

<wiki:toc max_depth="3"/>

= コンパイルとインストール =

== 準備 ==

KVSのコンパイルには、C/C++コンパイラが必要です。Windowsの場合は、Microsoft Visual C/C++を利用します。また、Linux/Mac OS Xの場合は、gccおよびmakeを利用します。その他にも、C/C++コンパイラはいくつか存在しますが、ここでは上記の２つのコンパイラの利用を想定して説明します。また、KVSを利用して可視化アプリケーションを開発する場合、可視化結果をウィンドウに表示するためにGLUTが必要となります。また、KVSではGPUの高速化機能を利用するためにGLEWを利用しています。特に、制限などがない場合、この２つのライブラリを事前にインストールしておいてください。

=== Windowsの場合 ===

Windowsの場合は、Microsoft Visual C/C++を利用します。無料版のMicrosoft Visual C/C++ Expressを利用することが可能ですので、以下からインストーラをダウンロードし、指示に従いインストールしてください。

 [http://www.microsoft.com/japan/msdn/vstudio/express/ Microsoft Visual Studio]

GLUTおよびGLEWは以下からバイナリファイルをダウンロードしてインストールしてください。

 [http://www.xmission.com/~nate/glut.html Nate Robins - OpenGL - GLUT for Win32]

 [http://glew.sourceforge.net/ GLEW: The OpenGL Extension Wrangler Library]

=== Linuxの場合 ===

Linuxの場合は、各ディストリビューションに応じたパッケージ管理ツールを利用してコンパイラ（gccとmake）およびGLUT、GLEWを簡単にインストールできます。各パッケージの開発版（devキーワードが付いたパッケージ）をインストールしてください。ただし、GLUTはfreeglutという名前でパッケージ管理されていることが多いです。freeglutというパッケージがある場合はそちらをインストールしてください。

=== Mac OS Xの場合 ===

Mac OS Xの場合は、Xcodeをインストールするとgccおよびmakeコマンドがインストールされます。付属DVDもしくは[http://developer.apple.com/devcenter/mac/index.action Mac Dev Center]からXcodeをダウンロードしインストールしてください。GLUTは既にインストールされていますので、あらためてインストールする必要はありません。GLEWは、[http://www.macports.org/ MacPorts]を利用してインストールすることができます。

== 設定 ==

KVSのコンパイルおよびインストールを行う前に各OSに応じて環境変数「KVS_DIR」を設定しておく必要があります。コンパイルされたライブラリファイルおよびヘッダファイルはKVS_DIRで指定されるディレクトリにインストールされます。また、いくつかのKVSコマンドラインアプリケーションがKVS_DIR/binにインストールされるため、そのディレクトリを環境変数「PATH」に追加しておく必要があります。以下に、OSごとの簡単な設定例を示します。

=== Linux/Mac OS X の場合 ===

Linux/Mac OS Xの場合は、以下のように環境変数を設定することができる。bashを利用している場合は、以下を「~/.bashrc」に記述します。その他のシェルについては、その規則に従い適切に設定してください。

 export KVS_DIR=/usr/local/kvs

 export PATH=$KVS_DIR/bin:$PATH

=== Windows（Microsoft Visual C/C++）の場合 ===

Windows系OSの場合は、システムのプロパティから設定することができます。「システムのプロパティ」→「詳細設定」→「環境変数」に以下を記述します。

 変数：「KVS_DIR」　値：「C:\Program Files\kvs」

 変数：「PATH」　値：「%PATH%;%KVS_DIR%\bin」

== ライブラリサポート ==

外部ライブラリサポートを設定ファイル（kvs.conf）の対応するフラグを有効化し（0を1にする）コンパイルすることで、プログラム開発においてその機能を容易に利用することができます。現在、KVSがサポートする外部ライブラリは以下のとおりです。ただし、利用するライブラリはあらかじめインストールしておく必要があります。

|| *ライブラリ名* || *フラグ名* || *説明* ||
|| CUDA || KVS_SUPPORT_CUDA || NVIDIA社が提供するGPU向け開発環境||
|| GLEW || KVS_SUPPORT_GLEW || OpenGLの拡張機能を容易に利用するためのライブラリ ||
|| GLUT || KVS_SUPPORT_GLUT || ウィンドウの制御などをOSに依存せず行うためのOpenGL準拠のライブラリ ||
|| OpenCV || KVS_SUPPORT_OPENCV || インテル社が開発したコンピュータビジョン向けライブラリ ||
|| Qt || KVS_SUPPORT_QT || ノキア社が開発するOSに依存しないUI開発ライブラリ ||
|| SAGE || KVS_SUPPORT_SAGE || イリノイ大学（EVL）が開発するタイルドディスプレイ向けライブラリ ||
|| OpenCABIN || KVS_SUPPORT_OPENCABIN || 東京大学が開発した没入型表示装置およびタイルドディスプレイ向けライブラリ ||

=== 設定例 ===

GLUTおよびGLEWを事前にインストールしている場合のkvs.confの設定例を以下に示します。KVS_SUPPORT_GLUTは初期状態で1となっていますので、KVS_SUPPORT_GLEWを1にしてください。

{{{
KVS_SUPPORT_CAVE      = 0
KVS_SUPPORT_CUDA      = 0
KVS_SUPPORT_GLEW      = 1
KVS_SUPPORT_GLUT      = 1
KVS_SUPPORT_OPENCV    = 0
KVS_SUPPORT_QT        = 0
KVS_SUPPORT_SAGE      = 0
KVS_SUPPORT_OPENCABIN = 0
}}}

== コンパイルとインストール ==

適当な場所にソースコードをダウンロード（チェックアウト）しコンパイルおよびインストールを行います。ソースコードをダウンロードしたディレクトリとKVS_DIRで指定するディレクトリは同じでもかまいませんが、ここでは別ディレクトリに格納されるものとして説明していきます。

=== Linux/Mac OS X の場合 ===

ホームディレクトリ直下のtmpディレクトリにkvsという名前でソースコードを展開したとします。コンパイルはそのディレクトリでmakeコマンドを実行するだけです。コンパイルが終了すればmakeコマンドにinstallというオプションを付けて実行することでインストールを行うことができます。ただし、環境変数KVS_DIRをルート権限が必要なディレクトリに設定した場合は、インストールの際に、スーパユーザ（su）になる必要があります。また、Mac OS X の場合は、sudoを利用してインストールすることができます。以下に実行例を示します。

 % cd ~/tmp/kvs

 % make

 % make install

=== Windows の場合 ===

Windowsの場合も先に説明したLinuxなどの場合と同様に簡単にコンパイルおよびインストールすることができます。Windows環境（Microsoft Visual C/C++）の場合、makeコマンドの代わりにnmakeコマンドを利用します。以下に実行例を示します。KVSのソースコードはCドライブ直下のtmpディレクトリにkvsという名前で展開されているとします。

 > cd C:\tmp\kvs

 > nmake

 > nmake install

== アンインストール ==

ソースコードをコンパイルしたディレクトリでmakeコマンドに「uninstall」を付け実行することでKVSをアンインストールすることができます。また、インストールしたディレクトリ（環境変数KVS_DIRで指定しているディレクトリ）を直接削除することでもアンインストールすることができます。各環境でのアンインストールの実行例を以下に示します。

=== Linux/Mac OS X/Cygwin の場合 ===

 % cd ~/tmp/kvs

 % make uninstall

=== Windows の場合 ===

 > cd C:\tmp\kvs

 > nmake uninstall